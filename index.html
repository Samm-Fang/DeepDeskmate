<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepDeskmate</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="app-wrapper"> <!-- 新增的包裹层 -->
    <div class="container"> <!-- 主内容区域 -->
        <div class="main-header">
            <h1>DeepDeskmate</h1>
            <!-- 模型配置按钮将移动到左下角 -->
        </div>

        <div class="input-section">
            <label for="person-description">输入人物描述:</label>
            <div class="description-input-group">
                <textarea id="person-description" rows="4" placeholder="例如：张三，男，技术负责人，擅长沟通协调。"></textarea>
                <button id="send-description">发送描述给AI</button>
            </div>
        </div>

        <div class="loading-indicator" id="loading" style="display: none;">
            AI 正在处理中...
        </div>

        <div class="content-wrapper">
            <div class="output-section">
                <h2>人员信息表</h2>
                <div class="controls">
                    <button id="clear-personnel-table" class="secondary-button">清除表格</button>
                    <button id="import-personnel-button" class="secondary-button">导入表格</button>
                    <button id="copy-personnel-info" class="secondary-button">复制人员信息</button>
                    <button id="toggle-personnel-list" class="secondary-button">折叠列表</button> 
                </div>
                <div id="loading" style="display: none;">AI正在思考...</div>
                <div class="personnel-thinking-output"> <!-- 新增：人员信息处理的思考过程 -->
                    <h3>AI 思考过程...</h3>
                    <pre></pre>
                </div>
                <div id="markdown-output-wrapper" class="personnel-list-wrapper"> <!-- 包裹 markdown-output -->
                    <div id="markdown-output"></div>
                </div>
                
                <div class="import-personnel-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <h3>导入人员信息表 (Markdown格式)</h3>
                    <textarea id="import-personnel-markdown" rows="6" placeholder="在此粘贴人员信息的Markdown表格，例如：\n| 人物 | 性别 | 备注 |\n| --- | --- | --- |\n| 张三 | 男 | 技术部 |\n| 李四 | 女 | 产品部 |"></textarea>
                    <!-- 导入按钮已移到上面的 controls div -->
                </div>
            </div>

            <div class="table-generator-section">
                <h2>座位列表生成器</h2>
                <div class="generator-controls">
                    <label for="rows">行数:</label>
                    <input type="number" id="rows" min="1" value="3">
                    <label for="cols">列数:</label>
                    <input type="number" id="cols" min="1" value="3">
                    <label for="desk-mates">同桌数:</label>
                    <input type="number" id="desk-mates" min="1" value="1">
                    <div class="generator-buttons">
                        <button id="generate-table">生成表格</button>
                        <button id="copy-arranged-table" class="secondary-button">复制编排结果</button>
                    </div>
                </div>
                <div class="arrangement-section">
                    <label for="arrangement-remarks">编排备注:</label>
                    <textarea id="arrangement-remarks" rows="3" placeholder="输入需要 AI 考虑的编排要求，例如：张三和李四是好朋友，请安排他们坐在一起。王五视力不好，请安排在前排。"></textarea>
                    <button id="ai-arrange-button">AI 智能编排</button>
                    
                    <div id="seat-modification-section" class="seat-modification-section" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <h3>细微调整座位</h3>
                        <p>当前人员信息表和上方显示的座位表将作为AI调整的参考。</p>
                        <textarea id="seat-modification-input" rows="3" placeholder="例如：请将张三和王五调换位置。李四想坐窗边。"></textarea>
                        <button id="send-seat-modification-button">发送修改指令</button>
                        <div id="seat-modification-loading" style="display: none;">AI 正在处理修改...</div>
                        <div class="seat-modify-thinking-output"> <!-- 新增：座位微调的思考过程 -->
                            <h3>AI 思考过程...</h3>
                            <pre></pre>
                        </div>
                        <div id="seat-modification-output" style="margin-top:10px; padding:10px; border:1px dashed #ccc; border-radius:4px; display:none;"></div>
                    </div>
                </div>
                <div id="ai-thinking-output"> <!-- 这个是座位编排的思考过程，保留id，但样式会通过class统一 -->
                    <h3>AI 思考过程...</h3>
                    <pre></pre> <!-- 用于显示思考过程 -->
                </div>
                <!-- arrangement-actions div removed as its content moved -->
                <div id="table-preview"></div>

                <div class="import-seat-table-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <h3>导入座位表 (Markdown格式)</h3>
                    <textarea id="import-seat-table-markdown" rows="6" placeholder="在此粘贴座位表的Markdown，AI将基于此进行修改。"></textarea>
                    <button id="import-seat-table-button" class="secondary-button">导入座位表</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 模型配置侧边栏 -->
    <aside id="settings-sidebar" class="sidebar closed"> <!-- 侧边栏现在是 app-wrapper 的一部分，初始关闭 -->
        <div class="sidebar-header">
            <h2>模型配置</h2>
            <!-- 关闭按钮已移除，将通过新的左下角按钮控制 -->
        </div>
        <div class="sidebar-content">
            <!-- DeepSeek 快速配置 -->
            <div class="config-section deepseek-quick-config">
                <h3>DeepSeek 快速配置</h3>
                <label for="deepseek-api-key">DeepSeek API Key:</label>
                <input type="password" id="deepseek-api-key" placeholder="在此输入 DeepSeek API Key">
                <button id="quick-config-deepseek">快速配置 DeepSeek</button>
            </div>

            <!-- 使用模型配置板块 -->
            <div class="config-section model-usage-settings">
                <h3>使用模型选择</h3>
                <div class="model-selection-group">
                    <label for="info-model-trigger">信息整理模型:</label>
                    <div class="custom-select-wrapper">
                        <button type="button" id="info-model-trigger" class="custom-select-trigger" data-dropdown-id="info-model-dropdown">--选择模型--</button>
                        <div class="custom-select-dropdown" id="info-model-dropdown">
                            <input type="text" class="model-search-input" placeholder="搜索模型...">
                            <ul class="custom-options-list"></ul>
                        </div>
                    </div>
                    <input type="hidden" id="info-model-select-value" name="infoModelValue">
                </div>
                <div class="model-selection-group">
                    <label for="seating-model-trigger">座位表生成模型:</label>
                    <div class="custom-select-wrapper">
                        <button type="button" id="seating-model-trigger" class="custom-select-trigger" data-dropdown-id="seating-model-dropdown">--选择模型--</button>
                        <div class="custom-select-dropdown" id="seating-model-dropdown">
                            <input type="text" class="model-search-input" placeholder="搜索模型...">
                            <ul class="custom-options-list"></ul>
                        </div>
                    </div>
                    <input type="hidden" id="seating-model-select-value" name="seatingModelValue">
                </div>
                <div class="model-selection-group">
                    <label for="seat-modify-model-trigger">座位微调模型:</label>
                    <div class="custom-select-wrapper">
                        <button type="button" id="seat-modify-model-trigger" class="custom-select-trigger" data-dropdown-id="seat-modify-model-dropdown">--选择模型--</button>
                        <div class="custom-select-dropdown" id="seat-modify-model-dropdown">
                            <input type="text" class="model-search-input" placeholder="搜索模型...">
                            <ul class="custom-options-list"></ul>
                        </div>
                    </div>
                    <input type="hidden" id="seat-modify-model-select-value" name="seatModifyModelValue">
                </div>
                <button id="save-model-usage-button">保存模型选择</button>
            </div>
            
            <!-- 提供商配置板块 -->
            <div class="config-section provider-settings">
                <h3>提供商配置</h3>
                <div id="provider-list">
                    <!-- 提供商条目将在这里动态添加 -->
                </div>
                <button id="add-provider-button">添加提供商</button>
            </div>

             <div id="active-config-display" class="active-config-display" style="display: none;"><p>当前信息整理模型: <strong></strong></p></div>
        </div>
    </aside>
</div> <!-- app-wrapper 结束 -->

    <!-- 新的侧边栏触发按钮 -->
    <button id="sidebar-toggle-button" class="sidebar-toggle-button">⚙️</button>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> 
    <script src="script.js"></script>
    <div id="footer" style="text-align: center; padding: 10px; background-color: #f0f0f0; width: 100%; opacity: 0; transition: opacity 0.5s ease;">
        <p>Developed By SammFang | GitHub: <a href="https://github.com/Samm-Fang/DeepDeskmate" target="_blank" rel="noopener noreferrer">https://github.com/Samm-Fang/DeepDeskmate</a></p>
    </div>
    <script>
        window.addEventListener('scroll', function() {
            const footer = document.getElementById('footer');
            const scrollPosition = window.innerHeight + window.pageYOffset;
            const totalHeight = document.documentElement.scrollHeight;
            if (scrollPosition >= totalHeight - 50) { // 提前50像素开始渐显
                footer.style.opacity = '1';
            } else {
                footer.style.opacity = '0';
            }
        });
        // 页面加载时检查滚动位置
        window.addEventListener('load', function() {
            const footer = document.getElementById('footer');
            const scrollPosition = window.innerHeight + window.pageYOffset;
            const totalHeight = document.documentElement.scrollHeight;
            if (scrollPosition >= totalHeight - 50) {
                footer.style.opacity = '1';
            }
        });
    </script>
</body>
</html>
